import{_ as _e,r as _,c as $,W as ve,d as p,b as m,f as l,w as s,i as n,e as i,t as u,F as P,k as Q,D as W,n as E,p as v,h as c,g as C,m as X,P as V,y as r,S as Z,X as fe,J as ye,Q as ge}from"./index-6DHakvZj.js";import{u as ke,a as Ye,c as he,b as De,g as Ve,d as be,e as we}from"./schedule-DamagGMV.js";const Me={class:"schedule-container"},xe={class:"date-text"},Ce={class:"events-dots"},He={class:"detail-header"},Re={class:"current-date-title"},Se={key:0,class:"header-actions"},$e={class:"events-list"},Ee={key:1,class:"event-items"},Ue=["onClick"],ze={class:"event-time"},Fe={class:"event-content"},Ne={class:"event-title"},Te={class:"title-text"},Be={key:0,class:"event-desc"},Ie={key:1,class:"event-meta"},Oe={key:0,class:"event-actions"},je={key:0},qe={style:{"margin-top":"0","word-break":"break-all"}},Ae={key:0},Je=["href"],Le={style:{"margin-top":"10px","white-space":"pre-wrap","word-break":"break-all"}},Pe={key:1,style:{"margin-top":"10px",color:"#E6A23C","font-size":"12px"}},Qe={__name:"Schedule",setup(We){const f=_(new Date),U=_([]),z=$(()=>{const t=localStorage.getItem("userInfo");return t?JSON.parse(t).role==="admin":!1}),k=_(!1),H=_(!1),Y=_(!1),b=_(null),o=_({id:null,type:"schedule",title:"",description:"",timeRange:[],remind_minutes:0,remind_minutes:0,meeting_link:""}),w=_(!1),d=_({}),G=t=>{d.value=t,w.value=!0},F=t=>p(t).format("YYYY-MM-DD HH:mm"),K=[new Date(2e3,1,1,9,0,0),new Date(2e3,1,1,10,0,0)],ee={title:[{required:!0,message:"请输入名称",trigger:"blur"}],timeRange:[{required:!0,message:"请选择时间范围",trigger:"change"}]},te=$(()=>{const t=Y.value?"编辑":"创建",e=o.value.type==="schedule"?"日程":"会议";return`${t}${e}`}),R=async()=>{const t=p(f.value),e=t.subtract(1,"month").startOf("month").format("YYYY-MM-DD"),M=t.add(1,"month").endOf("month").format("YYYY-MM-DD");try{const h=await Ve({start_date:e,end_date:M});U.value=h}catch(h){console.error(h),V.error("加载日程失败")}};ve(()=>f.value,()=>{R()},{immediate:!0});const N=t=>U.value.filter(e=>p(e.start_time).format("YYYY-MM-DD")===t),T=$(()=>{const t=p(f.value).format("YYYY-MM-DD");return N(t)}),le=t=>p(t).format("YYYY年MM月DD日"),B=t=>p(t).format("HH:mm"),I=t=>t<60?`${t}分钟`:t<1440?`${Math.floor(t/60)}小时`:`${Math.floor(t/1440)}天`,O=t=>{Y.value=!1,o.value={id:null,type:t,title:"",description:"",timeRange:[p(f.value).hour(9).minute(0).second(0).format("YYYY-MM-DD HH:mm:ss"),p(f.value).hour(10).minute(0).second(0).format("YYYY-MM-DD HH:mm:ss")],remind_minutes:0,meeting_link:""},k.value=!0},ae=t=>{Y.value=!0,o.value={id:t.id,type:t.type,title:t.title,description:t.description,timeRange:[t.start_time,t.end_time],remind_minutes:t.remind_minutes,meeting_link:t.meeting_link},o.value.timeRange=[p(t.start_time).format("YYYY-MM-DD HH:mm:ss"),p(t.end_time).format("YYYY-MM-DD HH:mm:ss")],k.value=!0},se=async t=>{try{await ge.confirm("确定要删除这个事件吗？","提示",{type:"warning"}),t.type==="schedule"?await be(t.id):await we(t.id),V.success("删除成功"),R()}catch(e){e!=="cancel"&&V.error("删除失败")}},oe=async()=>{b.value&&await b.value.validate(async t=>{if(t){H.value=!0;try{const e={title:o.value.title,description:o.value.description,start_time:o.value.timeRange[0],end_time:o.value.timeRange[1],remind_minutes:o.value.remind_minutes,meeting_link:o.value.meeting_link};Y.value?(o.value.type==="schedule"?await ke(o.value.id,e):await Ye(o.value.id,e),V.success("更新成功")):(o.value.type==="schedule"?await he(e):await De(e),V.success("创建成功")),k.value=!1,R()}catch(e){console.error(e),V.error(Y.value?"更新失败":"创建失败")}finally{H.value=!1}}})},ne=()=>{b.value&&b.value.resetFields()};return(t,e)=>{const M=n("el-calendar"),h=n("el-card"),j=n("el-col"),y=n("el-button"),ie=n("el-empty"),q=n("el-tag"),A=n("el-icon"),re=n("el-row"),J=n("el-radio"),ue=n("el-radio-group"),D=n("el-form-item"),S=n("el-input"),de=n("el-date-picker"),g=n("el-option"),me=n("el-select"),ce=n("el-form"),L=n("el-dialog");return r(),m("div",Me,[l(re,{gutter:20,style:{height:"100%"}},{default:s(()=>[l(j,{span:16,class:"calendar-col"},{default:s(()=>[l(h,{shadow:"hover",class:"calendar-card"},{default:s(()=>[l(M,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),ref:"calendarRef"},{"date-cell":s(({data:a})=>[i("div",{class:W(["date-cell",{"is-selected":a.isSelected}])},[i("div",xe,u(a.day.split("-").slice(2).join("")),1),i("div",Ce,[(r(!0),m(P,null,Q(N(a.day),(x,pe)=>(r(),m("span",{key:pe,class:W(["event-dot",x.type])},null,2))),128))])],2)]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(j,{span:8,class:"detail-col"},{default:s(()=>[l(h,{shadow:"hover",class:"detail-card"},{header:s(()=>[i("div",He,[i("span",Re,u(le(f.value)),1),z.value?(r(),m("div",Se,[l(y,{type:"primary",size:"small",onClick:e[1]||(e[1]=a=>O("schedule"))},{default:s(()=>[...e[13]||(e[13]=[c("创建日程",-1)])]),_:1}),l(y,{type:"success",size:"small",onClick:e[2]||(e[2]=a=>O("meeting"))},{default:s(()=>[...e[14]||(e[14]=[c("创建会议",-1)])]),_:1})])):v("",!0)])]),default:s(()=>[i("div",$e,[T.value.length===0?(r(),E(ie,{key:0,description:"暂无日程安排"})):(r(),m("div",Ee,[(r(!0),m(P,null,Q(T.value,a=>(r(),m("div",{key:a.id+a.type,class:"event-item",onClick:x=>G(a)},[i("div",ze,u(B(a.start_time))+" - "+u(B(a.end_time)),1),i("div",Fe,[i("div",Ne,[l(q,{size:"small",type:a.type==="schedule"?"primary":"success",effect:"dark",style:{"margin-right":"5px","flex-shrink":"0"}},{default:s(()=>[c(u(a.type==="schedule"?"日程":"会议"),1)]),_:2},1032,["type"]),i("span",Te,u(a.title),1)]),a.description?(r(),m("div",Be,u(a.description),1)):v("",!0),a.remind_minutes>0?(r(),m("div",Ie,[l(A,null,{default:s(()=>[l(C(X))]),_:1}),c(" 提前 "+u(I(a.remind_minutes))+" 通知 ",1)])):v("",!0)]),z.value?(r(),m("div",Oe,[l(y,{type:"primary",link:"",icon:C(fe),onClick:Z(x=>ae(a),["stop"])},null,8,["icon","onClick"]),l(y,{type:"danger",link:"",icon:C(ye),onClick:Z(x=>se(a),["stop"])},null,8,["icon","onClick"])])):v("",!0)],8,Ue))),128))]))])]),_:1})]),_:1})]),_:1}),l(L,{modelValue:k.value,"onUpdate:modelValue":e[10]||(e[10]=a=>k.value=a),title:te.value,width:"500px",onClosed:ne},{footer:s(()=>[l(y,{onClick:e[9]||(e[9]=a=>k.value=!1)},{default:s(()=>[...e[17]||(e[17]=[c("取消",-1)])]),_:1}),l(y,{type:"primary",onClick:oe,loading:H.value},{default:s(()=>[...e[18]||(e[18]=[c("确定",-1)])]),_:1},8,["loading"])]),default:s(()=>[l(ce,{model:o.value,"label-width":"80px",rules:ee,ref_key:"formRef",ref:b},{default:s(()=>[Y.value?v("",!0):(r(),E(D,{key:0,label:"类型"},{default:s(()=>[l(ue,{modelValue:o.value.type,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.type=a),disabled:""},{default:s(()=>[l(J,{label:"schedule"},{default:s(()=>[...e[15]||(e[15]=[c("日程",-1)])]),_:1}),l(J,{label:"meeting"},{default:s(()=>[...e[16]||(e[16]=[c("会议",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})),l(D,{label:"名称",prop:"title"},{default:s(()=>[l(S,{modelValue:o.value.title,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.title=a),placeholder:"请输入事件名称"},null,8,["modelValue"])]),_:1}),l(D,{label:"时间",prop:"timeRange"},{default:s(()=>[l(de,{modelValue:o.value.timeRange,"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.timeRange=a),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss","default-time":K},null,8,["modelValue"])]),_:1}),l(D,{label:"描述"},{default:s(()=>[l(S,{modelValue:o.value.description,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.description=a),type:"textarea",rows:"3",placeholder:"请输入详情描述"},null,8,["modelValue"])]),_:1}),o.value.type==="meeting"?(r(),E(D,{key:1,label:"会议链接"},{default:s(()=>[l(S,{modelValue:o.value.meeting_link,"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.meeting_link=a),placeholder:"例如 Zoom/腾讯会议 链接"},null,8,["modelValue"])]),_:1})):v("",!0),l(D,{label:"提前通知"},{default:s(()=>[l(me,{modelValue:o.value.remind_minutes,"onUpdate:modelValue":e[8]||(e[8]=a=>o.value.remind_minutes=a),placeholder:"请选择"},{default:s(()=>[l(g,{label:"不通知",value:0}),l(g,{label:"5分钟前",value:5}),l(g,{label:"15分钟前",value:15}),l(g,{label:"30分钟前",value:30}),l(g,{label:"1小时前",value:60}),l(g,{label:"2小时前",value:120}),l(g,{label:"1天前",value:1440})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(L,{modelValue:w.value,"onUpdate:modelValue":e[12]||(e[12]=a=>w.value=a),title:"事件详情",width:"500px"},{footer:s(()=>[l(y,{type:"primary",onClick:e[11]||(e[11]=a=>w.value=!1)},{default:s(()=>[...e[21]||(e[21]=[c("关闭",-1)])]),_:1})]),default:s(()=>[d.value?(r(),m("div",je,[i("h3",qe,u(d.value.title),1),l(q,{size:"small",type:d.value.type==="schedule"?"primary":"success",style:{"margin-bottom":"10px"}},{default:s(()=>[c(u(d.value.type==="schedule"?"日程":"会议"),1)]),_:1},8,["type"]),i("p",null,[e[19]||(e[19]=i("strong",null,"时间：",-1)),c(u(F(d.value.start_time))+" - "+u(F(d.value.end_time)),1)]),d.value.meeting_link?(r(),m("p",Ae,[e[20]||(e[20]=i("strong",null,"会议链接：",-1)),i("a",{href:d.value.meeting_link,target:"_blank"},u(d.value.meeting_link),9,Je)])):v("",!0),i("div",Le,u(d.value.description||"无描述"),1),d.value.remind_minutes>0?(r(),m("div",Pe,[l(A,null,{default:s(()=>[l(C(X))]),_:1}),c(" 提前 "+u(I(d.value.remind_minutes))+" 通知 ",1)])):v("",!0)])):v("",!0)]),_:1},8,["modelValue"])])}}},Ge=_e(Qe,[["__scopeId","data-v-28908c1f"]]);export{Ge as default};
