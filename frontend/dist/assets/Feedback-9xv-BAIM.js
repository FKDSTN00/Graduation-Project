import{O as U,a4 as ye,a5 as ue,a6 as ke,_ as ge,d as G,u as he,r as x,Z as be,o as we,b as h,e as l,C as Ye,f as a,n as X,p as H,g as v,w as s,h as i,a7 as Ce,i as y,a8 as Ve,N as Me,M as xe,F as ee,k as re,t as r,a9 as te,P as Y,y as m,aa as De,S as ie,J as $e,D as ae,ab as Fe,Q as de}from"./index-6DHakvZj.js";function Le(u){return U({url:"/feedback/",method:"get",params:u})}function Te(u){return U({url:"/feedback/",method:"post",data:u})}function Ue(u){return U({url:`/feedback/${u}`,method:"get"})}function ze(u,D){return U({url:`/feedback/${u}/reply`,method:"post",data:D})}function Be(u){return U({url:`/feedback/${u}`,method:"delete"})}function He(u){return U({url:`/feedback/reply/${u}`,method:"delete"})}function Se(u){return U({url:`/feedback/${u}/like`,method:"post"})}function Ne(u){return U({url:`/feedback/reply/${u}/like`,method:"post"})}var ce={exports:{}};(function(u,D){(function(k,b){u.exports=b()})(ue,function(){return function(k,b,C){k=k||{};var p=b.prototype,c={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function V(_,o,g,z){return p.fromToBase(_,o,g,z)}C.en.relativeTime=c,p.fromToBase=function(_,o,g,z,$){for(var E,S,I,j=g.$locale().relativeTime||c,R=k.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],J=R.length,T=0;T<J;T+=1){var M=R[T];M.d&&(E=z?C(_).diff(g,M.d,!0):g.diff(_,M.d,!0));var F=(k.rounding||Math.round)(Math.abs(E));if(I=E>0,F<=M.r||!M.r){F<=1&&T>0&&(M=R[T-1]);var N=j[M.l];$&&(F=$(""+F)),S=typeof N=="string"?N.replace("%d",F):N(F,o,M.l,I);break}}if(o)return S;var B=I?j.future:j.past;return typeof B=="function"?B(S):B.replace("%s",S)},p.to=function(_,o){return V(_,o,this,!0)},p.from=function(_,o){return V(_,o,this)};var d=function(_){return _.$u?C.utc():C()};p.toNow=function(_){return this.to(d(this),_)},p.fromNow=function(_){return this.from(d(this),_)}}})})(ce);var Ae=ce.exports;const Ee=ye(Ae);var Ie={exports:{}};(function(u,D){(function(k,b){u.exports=b(ke)})(ue,function(k){function b(c){return c&&typeof c=="object"&&"default"in c?c:{default:c}}var C=b(k),p={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(c,V){return V==="W"?c+"周":c+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(c,V){var d=100*c+V;return d<600?"凌晨":d<900?"早上":d<1100?"上午":d<1300?"中午":d<1800?"下午":"晚上"}};return C.default.locale(p,null,!0),p})})(Ie);const je={class:"feedback-container"},Re={class:"header-section"},qe={class:"filter-bar"},Ke={class:"post-list"},Pe={key:0,class:"empty-state"},Ge={key:1,class:"post-items"},Je=["onClick"],Oe={class:"post-main"},Qe={class:"post-header"},We={class:"post-title"},Ze={class:"post-summary"},Xe={class:"post-meta"},et={class:"user-meta"},tt=["onClick"],at={class:"post-stats"},lt=["onClick"],st={class:"reply-badge",title:"评论"},ot={key:0,class:"last-reply"},nt={key:0,class:"detail-content"},rt={class:"main-post"},it={class:"post-author-row"},dt={class:"author-info"},ut={class:"author-name"},ct={class:"post-time"},_t={class:"post-body"},mt={class:"post-actions-bar"},pt={class:"reply-list"},ft={class:"reply-content-wrapper"},vt={class:"reply-header"},yt={class:"reply-actions-top"},kt=["onClick"],gt={class:"reply-time"},ht={class:"reply-text"},bt={key:0,class:"no-replies"},wt={class:"reply-input-area"},Yt={class:"reply-actions"},Ct={__name:"Feedback",setup(u){G.extend(Ee),G.locale("zh-cn");const D=he(),k=x(!1),b=x([]),C=x("all"),p=x(""),c=x(!1),V=x(!1),d=be({title:"",category:"message",content:""}),_=x(!1),o=x(null),g=x(""),z=x(!1),$=async()=>{k.value=!0;try{const n={category:C.value,keyword:p.value},e=await Le(n);b.value=e}catch(n){console.error(n)}finally{k.value=!1}},E=()=>{d.title="",d.content="",d.category="message",c.value=!0},S=async()=>{var n,e;if(!d.title||!d.content){Y.warning("请填写完整信息");return}V.value=!0;try{await Te(d),Y.success("发布成功"),c.value=!1,$()}catch(f){Y.error(((e=(n=f.response)==null?void 0:n.data)==null?void 0:e.msg)||"发布失败")}finally{V.value=!1}},I=async n=>{try{const e=await Ue(n.id);o.value=e,g.value="",_.value=!0}catch{Y.error("获取详情失败")}},j=async()=>{if(!g.value.trim()){Y.warning("请输入回复内容");return}z.value=!0;try{const n=await ze(o.value.id,{content:g.value});Y.success("回复成功"),o.value.replies.push(n.data),g.value=""}catch{Y.error("回复失败")}finally{z.value=!1}},R=(n,e)=>{e&&e.stopPropagation(),de.confirm("确定删除该帖子吗？","警告",{type:"warning"}).then(async()=>{var f,L;try{await Be(n.id),Y.success("删除成功"),$(),_.value=!1}catch(A){Y.error(((L=(f=A.response)==null?void 0:f.data)==null?void 0:L.msg)||"删除失败")}}).catch(()=>{})},J=n=>{de.confirm("确定删除该回复吗？","警告",{type:"warning"}).then(async()=>{try{await He(n.id),Y.success("删除成功"),o.value&&(o.value.replies=o.value.replies.filter(e=>e.id!==n.id))}catch{Y.error("删除失败")}}).catch(()=>{})},T=async n=>{try{const e=await Se(n.id);n.is_liked=e.is_liked,n.like_count=e.like_count}catch{}},M=async n=>{try{const e=await Ne(n.id);n.is_liked=e.is_liked,n.like_count=e.like_count}catch{}},F=n=>({message:"留言",bug:"Bug反馈",suggestion:"建议"})[n]||"讨论",N=n=>({message:"info",bug:"danger",suggestion:"success"})[n]||"",B=n=>G(n).format("YYYY-MM-DD HH:mm"),_e=n=>G(n).fromNow();return we(()=>{$()}),(n,e)=>{var oe,ne;const f=y("el-icon"),L=y("el-button"),A=y("el-radio-button"),le=y("el-radio-group"),P=y("el-input"),me=y("el-empty"),O=y("el-tag"),Q=y("el-avatar"),pe=y("el-divider"),se=y("el-dialog"),W=y("el-form-item"),Z=y("el-radio"),fe=y("el-form"),ve=xe("loading");return m(),h("div",je,[l("div",Re,[e[11]||(e[11]=l("div",{class:"title-group"},[l("h2",null,"留言与反馈"),l("p",{class:"subtitle"},"分享您的想法，反馈问题，或参与社区讨论")],-1)),((oe=v(D).userInfo)==null?void 0:oe.role)!=="admin"?(m(),X(L,{key:0,type:"primary",onClick:E},{default:s(()=>[a(f,{class:"mr-1"},{default:s(()=>[a(v(Ce))]),_:1}),e[10]||(e[10]=i(" 发布留言 ",-1))]),_:1})):H("",!0)]),l("div",qe,[a(le,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=t=>C.value=t),onChange:$},{default:s(()=>[a(A,{label:"all"},{default:s(()=>[...e[12]||(e[12]=[i("全部",-1)])]),_:1}),a(A,{label:"message"},{default:s(()=>[...e[13]||(e[13]=[i("留言",-1)])]),_:1}),a(A,{label:"bug"},{default:s(()=>[...e[14]||(e[14]=[i("Bug反馈",-1)])]),_:1}),a(A,{label:"suggestion"},{default:s(()=>[...e[15]||(e[15]=[i("建议",-1)])]),_:1})]),_:1},8,["modelValue"]),a(P,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t),placeholder:"搜索关键词",style:{width:"240px"},clearable:"",onClear:$,onKeyup:Me($,["enter"])},{prefix:s(()=>[a(f,null,{default:s(()=>[a(v(Ve))]),_:1})]),_:1},8,["modelValue"])]),Ye((m(),h("div",Ke,[b.value.length===0?(m(),h("div",Pe,[a(me,{description:"暂无相关帖子"})])):(m(),h("div",Ge,[(m(!0),h(ee,null,re(b.value,t=>{var q,K;return m(),h("div",{key:t.id,class:"post-item",onClick:w=>I(t)},[l("div",Oe,[l("div",Qe,[a(O,{size:"small",type:N(t.category)},{default:s(()=>[i(r(F(t.category)),1)]),_:2},1032,["type"]),l("h3",We,r(t.title),1)]),l("p",Ze,r(t.content),1),l("div",Xe,[l("div",et,[a(Q,{size:20,src:t.avatar},{default:s(()=>{var w;return[i(r((w=t.username)==null?void 0:w.charAt(0).toUpperCase()),1)]}),_:2},1032,["src"]),l("span",null,r(t.username),1)]),e[18]||(e[18]=l("span",{class:"divider"},"|",-1)),l("span",null,"发布于 "+r(B(t.created_at)),1),e[19]||(e[19]=l("span",{class:"divider"},"|",-1)),l("span",null,[a(f,null,{default:s(()=>[a(v(De))]),_:1}),i(" "+r(t.view_count),1)]),((q=v(D).userInfo)==null?void 0:q.role)==="admin"||((K=v(D).userInfo)==null?void 0:K.id)===t.user_id?(m(),h(ee,{key:0},[e[17]||(e[17]=l("span",{class:"divider"},"|",-1)),l("span",{class:"delete-action",onClick:ie(w=>R(t,w),["stop"])},[a(f,null,{default:s(()=>[a(v($e))]),_:1}),e[16]||(e[16]=i(" 删除 ",-1))],8,tt)],64)):H("",!0)])]),l("div",at,[l("div",{class:"reply-badge",onClick:ie(w=>T(t),["stop"]),title:"点赞"},[a(f,{class:ae({"is-liked":t.is_liked})},{default:s(()=>[a(v(te))]),_:1},8,["class"]),l("span",null,r(t.like_count),1)],8,lt),l("div",st,[a(f,null,{default:s(()=>[a(v(Fe))]),_:1}),l("span",null,r(t.reply_count),1)]),t.last_reply_at?(m(),h("span",ot," 最后回复 "+r(_e(t.last_reply_at)),1)):H("",!0)])],8,Je)}),128))]))])),[[ve,k.value]]),a(se,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=t=>_.value=t),width:"800px",top:"5vh","destroy-on-close":"",title:(ne=o.value)==null?void 0:ne.title,class:"feedback-detail-dialog"},{default:s(()=>[o.value?(m(),h("div",nt,[l("div",rt,[l("div",it,[l("div",dt,[a(Q,{size:40,src:o.value.avatar},{default:s(()=>{var t;return[i(r((t=o.value.username)==null?void 0:t.charAt(0).toUpperCase()),1)]}),_:1},8,["src"]),l("div",null,[l("div",ut,r(o.value.username),1),l("div",ct,r(B(o.value.created_at))+" · "+r(o.value.view_count)+" 浏览",1)])]),a(O,{type:N(o.value.category)},{default:s(()=>[i(r(F(o.value.category)),1)]),_:1},8,["type"])]),l("div",_t,r(o.value.content),1),l("div",mt,[a(L,{type:o.value.is_liked?"primary":"",plain:!o.value.is_liked,onClick:e[2]||(e[2]=t=>T(o.value))},{default:s(()=>[a(f,{class:"mr-1"},{default:s(()=>[a(v(te))]),_:1}),i(" "+r(o.value.is_liked?"已赞":"点赞")+" "+r(o.value.like_count),1)]),_:1},8,["type","plain"])])]),a(pe,{"content-position":"left"},{default:s(()=>[i("评论 ("+r(o.value.replies.length)+")",1)]),_:1}),l("div",pt,[(m(!0),h(ee,null,re(o.value.replies,t=>{var q,K;return m(),h("div",{key:t.id,class:"reply-item"},[a(Q,{size:32,src:t.avatar,class:"reply-avatar"},{default:s(()=>{var w;return[i(r((w=t.username)==null?void 0:w.charAt(0).toUpperCase()),1)]}),_:2},1032,["src"]),l("div",ft,[l("div",vt,[l("span",{class:ae(["reply-author",{"is-admin":t.role==="admin"}])},[i(r(t.username)+" ",1),t.role==="admin"?(m(),X(O,{key:0,size:"small",type:"danger",effect:"plain",class:"admin-badge"},{default:s(()=>[...e[20]||(e[20]=[i("管理员",-1)])]),_:1})):H("",!0)],2),l("div",yt,[l("div",{class:"like-action mr-2",onClick:w=>M(t)},[a(f,{class:ae({"is-liked":t.is_liked})},{default:s(()=>[a(v(te))]),_:1},8,["class"]),l("span",null,r(t.like_count||0),1)],8,kt),l("span",gt,r(B(t.created_at)),1),((q=v(D).userInfo)==null?void 0:q.role)==="admin"||((K=v(D).userInfo)==null?void 0:K.id)===t.user_id?(m(),X(L,{key:0,type:"danger",link:"",size:"small",class:"ml-2",onClick:w=>J(t)},{default:s(()=>[...e[21]||(e[21]=[i("删除",-1)])]),_:1},8,["onClick"])):H("",!0)])]),l("div",ht,r(t.content),1)])])}),128)),o.value.replies.length===0?(m(),h("div",bt," 暂无评论，快来抢沙发吧~ ")):H("",!0)])])):H("",!0),l("div",wt,[a(P,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=t=>g.value=t),type:"textarea",rows:3,placeholder:"友善回复，理性探讨...",resize:"none"},null,8,["modelValue"]),l("div",Yt,[a(L,{type:"primary",loading:z.value,onClick:j},{default:s(()=>[...e[22]||(e[22]=[i("发送回复",-1)])]),_:1},8,["loading"])])])]),_:1},8,["modelValue","title"]),a(se,{modelValue:c.value,"onUpdate:modelValue":e[9]||(e[9]=t=>c.value=t),title:"发布新帖子",width:"500px"},{footer:s(()=>[a(L,{onClick:e[8]||(e[8]=t=>c.value=!1)},{default:s(()=>[...e[26]||(e[26]=[i("取消",-1)])]),_:1}),a(L,{type:"primary",loading:V.value,onClick:S},{default:s(()=>[...e[27]||(e[27]=[i("发布",-1)])]),_:1},8,["loading"])]),default:s(()=>[a(fe,{model:d,"label-position":"top"},{default:s(()=>[a(W,{label:"标题"},{default:s(()=>[a(P,{modelValue:d.title,"onUpdate:modelValue":e[5]||(e[5]=t=>d.title=t),placeholder:"简要描述您的问题或观点"},null,8,["modelValue"])]),_:1}),a(W,{label:"分类"},{default:s(()=>[a(le,{modelValue:d.category,"onUpdate:modelValue":e[6]||(e[6]=t=>d.category=t)},{default:s(()=>[a(Z,{label:"message"},{default:s(()=>[...e[23]||(e[23]=[i("留言",-1)])]),_:1}),a(Z,{label:"bug"},{default:s(()=>[...e[24]||(e[24]=[i("Bug反馈",-1)])]),_:1}),a(Z,{label:"suggestion"},{default:s(()=>[...e[25]||(e[25]=[i("建议",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(W,{label:"内容"},{default:s(()=>[a(P,{modelValue:d.content,"onUpdate:modelValue":e[7]||(e[7]=t=>d.content=t),type:"textarea",rows:6,placeholder:"详细描述..."},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Mt=ge(Ct,[["__scopeId","data-v-49561844"]]);export{Mt as default};
