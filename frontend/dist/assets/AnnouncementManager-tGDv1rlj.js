import{g as j,e as F,u as I,f as J}from"./notice-BIvWqKNf.js";import{_ as P,r as i,o as Q,i as s,M as S,b as X,y as C,e as x,C as G,f as l,w as t,h as r,n as K,t as D,d as L,g as M,X as O,J as W,P as d,Q as Z}from"./index-6DHakvZj.js";const h={class:"announcement-manager"},ee={class:"header"},le={__name:"AnnouncementManager",setup(te){const w=i([]),v=i(!1),u=i(!1),c=i(!1),m=i(!1),_=i(null),o=i({id:null,title:"",content:"",level:"normal"}),N={title:[{required:!0,message:"请输入标题",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]},g=async()=>{v.value=!0;try{const n=await j();w.value=n}catch{d.error("加载失败")}finally{v.value=!1}},B=()=>{m.value=!1,o.value={title:"",content:"",level:"normal"},u.value=!0},E=n=>{m.value=!0,o.value={...n},u.value=!0},U=async()=>{_.value&&await _.value.validate(async n=>{if(n){c.value=!0;try{m.value?(await I(o.value.id,o.value),d.success("更新成功")):(await J(o.value),d.success("发布成功")),u.value=!1,g()}catch(e){console.error(e),d.error(m.value?"更新失败":"发布失败")}finally{c.value=!1}}})},Y=n=>{Z.confirm("确定删除该公告吗？","提示",{type:"warning"}).then(async()=>{try{await F(n.id),d.success("删除成功"),g()}catch{d.error("删除失败")}})},$=n=>L(n).format("YYYY-MM-DD HH:mm");return Q(()=>{g()}),(n,e)=>{const p=s("el-button"),f=s("el-table-column"),y=s("el-tag"),q=s("el-table"),V=s("el-input"),b=s("el-form-item"),k=s("el-radio"),z=s("el-radio-group"),A=s("el-form"),H=s("el-dialog"),R=S("loading");return C(),X("div",h,[x("div",ee,[e[6]||(e[6]=x("h3",null,"公告管理",-1)),l(p,{type:"primary",onClick:B},{default:t(()=>[...e[5]||(e[5]=[r("发布公告",-1)])]),_:1})]),G((C(),K(q,{data:w.value,style:{width:"100%"}},{default:t(()=>[l(f,{prop:"title",label:"标题","min-width":"200","show-overflow-tooltip":""}),l(f,{prop:"level",label:"等级",width:"100"},{default:t(({row:a})=>[l(y,{type:a.level==="important"?"danger":"primary"},{default:t(()=>[r(D(a.level==="important"?"重要":"普通"),1)]),_:2},1032,["type"])]),_:1}),l(f,{prop:"created_at",label:"发布时间",width:"180"},{default:t(({row:a})=>[r(D($(a.created_at)),1)]),_:1}),l(f,{label:"操作",width:"180",align:"right"},{default:t(({row:a})=>[l(p,{link:"",type:"primary",icon:M(O),onClick:T=>E(a)},{default:t(()=>[...e[7]||(e[7]=[r("编辑",-1)])]),_:1},8,["icon","onClick"]),l(p,{link:"",type:"danger",icon:M(W),onClick:T=>Y(a)},{default:t(()=>[...e[8]||(e[8]=[r("删除",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[R,v.value]]),l(H,{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=a=>u.value=a),title:m.value?"编辑公告":"发布公告",width:"500px"},{footer:t(()=>[l(p,{onClick:e[3]||(e[3]=a=>u.value=!1)},{default:t(()=>[...e[13]||(e[13]=[r("取消",-1)])]),_:1}),l(p,{type:"primary",onClick:U,loading:c.value},{default:t(()=>[...e[14]||(e[14]=[r("确定",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(A,{model:o.value,"label-width":"80px",rules:N,ref_key:"formRef",ref:_},{default:t(()=>[l(b,{label:"标题",prop:"title"},{default:t(()=>[l(V,{modelValue:o.value.title,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.title=a),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),l(b,{label:"等级",prop:"level"},{default:t(()=>[l(z,{modelValue:o.value.level,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.level=a)},{default:t(()=>[l(k,{label:"normal"},{default:t(()=>[e[10]||(e[10]=r("普通 ",-1)),l(y,{size:"small",type:"primary"},{default:t(()=>[...e[9]||(e[9]=[r("蓝色",-1)])]),_:1})]),_:1}),l(k,{label:"important"},{default:t(()=>[e[12]||(e[12]=r("重要 ",-1)),l(y,{size:"small",type:"danger"},{default:t(()=>[...e[11]||(e[11]=[r("红色",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"内容",prop:"content"},{default:t(()=>[l(V,{type:"textarea",modelValue:o.value.content,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.content=a),rows:"6",placeholder:"请输入正文"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ne=P(le,[["__scopeId","data-v-569ce0c0"]]);export{ne as default};
