import{_ as fe,a as ge,s as ye,r as i,o as we,c as be,d as f,b as V,e as s,f as l,w as o,h as u,i as n,g as m,H as ke,t as c,C as he,n as C,p as Ve,M as De,D as j,v as Ce,F as L,k as q,O as z,Q as Te,P as U,y as d}from"./index-6DHakvZj.js";const xe={class:"tasks-page"},Me={class:"page-header"},He={class:"stats-content"},Se={class:"stats-info"},Ue={class:"stats-item"},Ye={class:"value"},$e={class:"stats-item"},Be={class:"value success"},Ee={class:"stats-item"},Fe={class:"value primary"},Le={class:"stats-item"},qe={class:"value warning"},Ne={class:"progress-section"},Oe={class:"related-docs-list"},Ie={key:1},Pe={class:"doc-selector"},Re={class:"dialog-footer"},je={__name:"Tasks",setup(ze){const _=ge(),{stats:g}=ye(_),T=i("all"),A=i(!1),y=i(!1),Y=i(null),x=i(!1),$=i(null),r=i({title:"",priority:"Medium",deadline:"",notes:"",relatedDocs:[]}),Q={title:[{required:!0,message:"请输入任务标题",trigger:"blur"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}],deadline:[{required:!0,message:"请选择截止时间",trigger:"change"}]},M=i([]),w=i(null),N=i([]),B=async()=>{try{const a=await z.get("/docs/folders");M.value=a.sort((e,v)=>e.order-v.order),H()}catch(a){console.error("加载文件夹失败",a)}};we(async()=>{_.fetchTasks(),B()});const H=async()=>{try{const a={};w.value&&(a.folder_id=w.value);const e=await z.get("/docs/",{params:a});N.value=e}catch(a){console.error("加载文档失败",a)}},G=()=>{H()},O=be(()=>{let a=_.tasks;return T.value!=="all"&&(a=a.filter(e=>e.status===T.value)),[...a].sort((e,v)=>e.deadline?v.deadline?f(e.deadline).valueOf()-f(v.deadline).valueOf():-1:1)}),J=a=>({High:"danger",Medium:"warning",Low:"info"})[a]||"info",K=a=>({pending:"warning","in-progress":"",completed:"success"})[a]||"info",W=a=>({pending:"待处理","in-progress":"进行中",completed:"已完成"})[a]||a,X=a=>a.status==="completed"?!1:f().isAfter(f(a.deadline)),Z=a=>a.getTime()<new Date().setHours(0,0,0,0),ee=()=>{x.value=!1,$.value=null,r.value={title:"",priority:"Medium",deadline:f().format("YYYY-MM-DD HH:mm"),notes:"",relatedDocs:[]},w.value=null,M.value.length===0?B():H(),y.value=!0},le=a=>{x.value=!0,$.value=a.id,r.value={title:a.title,priority:a.priority,deadline:a.deadline,notes:a.notes||"",relatedDocs:a.relatedDocs||[]},w.value=null,M.value.length===0?B():H(),y.value=!0},te=async()=>{Y.value&&await Y.value.validate(a=>{if(a){if(f(r.value.deadline).isBefore(f())){U.warning("截止时间不能早于当前时间");return}x.value?(_.updateTask($.value,{...r.value}),U.success("更新成功")):(_.addTask({...r.value}),U.success("创建成功")),y.value=!1}})},ae=a=>{_.toggleTaskStatus(a.id)},oe=a=>{Te.confirm("确定要删除该任务吗？","提示",{type:"warning"}).then(()=>{_.deleteTask(a.id),U.success("已删除")}).catch(()=>{})};return(a,e)=>{const v=n("el-icon"),b=n("el-button"),E=n("el-divider"),se=n("el-progress"),I=n("el-card"),S=n("el-tab-pane"),ne=n("el-tabs"),re=n("el-checkbox"),p=n("el-table-column"),P=n("el-tag"),de=n("el-link"),ie=n("el-popover"),ue=n("el-table"),ce=n("el-empty"),R=n("el-input"),D=n("el-form-item"),k=n("el-option"),F=n("el-select"),pe=n("el-date-picker"),me=n("el-form"),_e=n("el-dialog"),ve=De("loading");return d(),V("div",xe,[s("div",Me,[e[10]||(e[10]=s("h2",null,"任务管理",-1)),l(b,{type:"primary",onClick:ee},{default:o(()=>[l(v,null,{default:o(()=>[l(m(ke))]),_:1}),e[9]||(e[9]=u(" 新建任务 ",-1))]),_:1})]),l(I,{class:"stats-card",shadow:"hover"},{default:o(()=>[s("div",He,[s("div",Se,[s("div",Ue,[e[11]||(e[11]=s("span",{class:"label"},"总任务",-1)),s("span",Ye,c(m(g).total),1)]),l(E,{direction:"vertical"}),s("div",$e,[e[12]||(e[12]=s("span",{class:"label"},"已完成",-1)),s("span",Be,c(m(g).completed),1)]),l(E,{direction:"vertical"}),s("div",Ee,[e[13]||(e[13]=s("span",{class:"label"},"进行中",-1)),s("span",Fe,c(m(g).inProgress),1)]),l(E,{direction:"vertical"}),s("div",Le,[e[14]||(e[14]=s("span",{class:"label"},"待处理",-1)),s("span",qe,c(m(g).pending),1)])]),s("div",Ne,[e[15]||(e[15]=s("span",{class:"label"},"完成进度",-1)),l(se,{percentage:m(g).percentage,status:m(g).percentage===100?"success":"","stroke-width":15,style:{width:"300px"}},null,8,["percentage","status"])])])]),_:1}),l(I,{class:"list-card"},{default:o(()=>[l(ne,{modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=t=>T.value=t)},{default:o(()=>[l(S,{label:"全部",name:"all"}),l(S,{label:"待处理",name:"pending"}),l(S,{label:"进行中",name:"in-progress"}),l(S,{label:"已完成",name:"completed"})]),_:1},8,["modelValue"]),he((d(),C(ue,{data:O.value,style:{width:"100%"}},{default:o(()=>[l(p,{width:"60"},{default:o(t=>[l(re,{"model-value":t.row.status==="completed",onChange:h=>ae(t.row)},null,8,["model-value","onChange"])]),_:1}),l(p,{prop:"title",label:"任务标题","min-width":"150"},{default:o(t=>[s("span",{class:j({"completed-text":t.row.status==="completed"})},c(t.row.title),3)]),_:1}),l(p,{prop:"notes",label:"备注","min-width":"150","show-overflow-tooltip":"",align:"center"}),l(p,{prop:"status",label:"状态",width:"100",align:"center"},{default:o(t=>[l(P,{type:K(t.row.status)},{default:o(()=>[u(c(W(t.row.status)),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"priority",label:"优先级",width:"100",align:"center"},{default:o(t=>[l(P,{type:J(t.row.priority),effect:"plain"},{default:o(()=>[u(c(t.row.priority),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"deadline",label:"截止时间",width:"180",align:"center"},{default:o(t=>[s("span",{class:j({overdue:X(t.row)})},[l(v,null,{default:o(()=>[l(m(Ce))]),_:1}),u(" "+c(t.row.deadline),1)],2)]),_:1}),l(p,{label:"关联文档",width:"100",align:"center"},{default:o(t=>[t.row.relatedDocs&&t.row.relatedDocs.length>0?(d(),C(ie,{key:0,placement:"left",title:"关联文档",width:250,trigger:"hover"},{reference:o(()=>[l(b,{link:"",type:"primary"},{default:o(()=>[u("查看("+c(t.row.relatedDocs.length)+")",1)]),_:2},1024)]),default:o(()=>[s("ul",Oe,[(d(!0),V(L,null,q(t.row.relatedDocs,h=>(d(),V("li",{key:h.id},[l(de,{type:"primary",underline:!1,onClick:Ae=>a.$router.push(`/documents/edit/${h.id}`)},{default:o(()=>[u(c(h.title),1)]),_:2},1032,["onClick"])]))),128))])]),_:2},1024)):(d(),V("span",Ie,"-"))]),_:1}),l(p,{label:"操作",width:"150",align:"center"},{default:o(t=>[l(b,{type:"primary",link:"",icon:"Edit",onClick:h=>le(t.row)},{default:o(()=>[...e[16]||(e[16]=[u("编辑",-1)])]),_:1},8,["onClick"]),l(b,{type:"danger",link:"",icon:"Delete",onClick:h=>oe(t.row)},{default:o(()=>[...e[17]||(e[17]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ve,A.value]]),O.value.length===0?(d(),C(ce,{key:0,description:"暂无任务"})):Ve("",!0)]),_:1}),l(_e,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=t=>y.value=t),title:x.value?"编辑任务":"新建任务",width:"600px","destroy-on-close":""},{footer:o(()=>[s("span",Re,[l(b,{onClick:e[7]||(e[7]=t=>y.value=!1)},{default:o(()=>[...e[18]||(e[18]=[u("取消",-1)])]),_:1}),l(b,{type:"primary",onClick:te},{default:o(()=>[...e[19]||(e[19]=[u("确定",-1)])]),_:1})])]),default:o(()=>[l(me,{model:r.value,ref_key:"formRef",ref:Y,rules:Q,"label-width":"80px"},{default:o(()=>[l(D,{label:"标题",prop:"title"},{default:o(()=>[l(R,{modelValue:r.value.title,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value.title=t),placeholder:"请输入任务标题"},null,8,["modelValue"])]),_:1}),l(D,{label:"优先级",prop:"priority"},{default:o(()=>[l(F,{modelValue:r.value.priority,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.priority=t),placeholder:"请选择优先级",style:{width:"100%"}},{default:o(()=>[l(k,{label:"High (高)",value:"High"}),l(k,{label:"Medium (中)",value:"Medium"}),l(k,{label:"Low (低)",value:"Low"})]),_:1},8,["modelValue"])]),_:1}),l(D,{label:"截止时间",prop:"deadline"},{default:o(()=>[l(pe,{modelValue:r.value.deadline,"onUpdate:modelValue":e[3]||(e[3]=t=>r.value.deadline=t),type:"datetime",placeholder:"选择截止时间","value-format":"YYYY-MM-DD HH:mm",style:{width:"100%"},"disabled-date":Z},null,8,["modelValue"])]),_:1}),l(D,{label:"备注"},{default:o(()=>[l(R,{modelValue:r.value.notes,"onUpdate:modelValue":e[4]||(e[4]=t=>r.value.notes=t),type:"textarea",rows:2,placeholder:"请输入备注说明（可选）"},null,8,["modelValue"])]),_:1}),l(D,{label:"关联文档"},{default:o(()=>[s("div",Pe,[l(F,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=t=>w.value=t),placeholder:"选择文件夹",style:{width:"100%","margin-bottom":"12px"},onChange:G},{default:o(()=>[l(k,{label:"全部文档",value:null}),(d(!0),V(L,null,q(M.value,t=>(d(),C(k,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(F,{modelValue:r.value.relatedDocs,"onUpdate:modelValue":e[6]||(e[6]=t=>r.value.relatedDocs=t),placeholder:"选择关联文档 (可多选)",style:{width:"100%"},multiple:"","value-key":"id","collapse-tags":"","collapse-tags-tooltip":""},{default:o(()=>[(d(!0),V(L,null,q(N.value,t=>(d(),C(k,{key:t.id,label:t.title,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ge=fe(je,[["__scopeId","data-v-632e2a5a"]]);export{Ge as default};
