import{_ as F,u as I,a as L,s as R,c as T,r as x,o as P,d as _,b as u,e as s,f as a,t as l,g as f,w as n,h as i,i as m,j as G,l as J,F as v,k as h,m as K,n as z,p as H,q as O,v as Q,x as W,y as r}from"./index-6DHakvZj.js";import{g as X}from"./notice-BIvWqKNf.js";import{g as Z}from"./schedule-DamagGMV.js";const ee={class:"home-dashboard"},te={class:"welcome-section"},se={class:"welcome-text"},ae={class:"quick-actions"},ne={class:"dashboard-grid"},oe={class:"main-column"},le={class:"card-header"},de={class:"announcement-list"},ie={class:"announcement-title"},re=["onClick"],ce={class:"announcement-date"},ue={class:"side-column"},_e={class:"card-header"},me={class:"task-list"},pe={class:"task-info"},fe={class:"task-deadline"},ve={class:"card-header"},he={class:"meeting-list"},ye={class:"meeting-time-badge"},ge={class:"month"},ke={class:"day"},we={class:"meeting-details"},De={class:"meeting-title"},be={class:"meeting-time"},xe={class:"announcement-list"},Ce={class:"announcement-title"},Ye=["onClick"],Me={class:"announcement-date"},Ve={__name:"Home",setup($e){const y=W(),N=I(),C=L(),{pendingTasks:S}=R(C),Y=T(()=>[...S.value].sort((e,c)=>e.deadline?c.deadline?new Date(e.deadline)-new Date(c.deadline):-1:1).slice(0,3)),g=x([]),B=T(()=>g.value.slice(0,8)),k=x(!1),w=x([]),U=()=>{y.push("/documents/create")},j=()=>{y.push("/tasks")},q=o=>({High:"danger",Medium:"warning",Low:"info"})[o]||"info",M=o=>{const{href:e}=y.resolve({name:"announcement-detail",params:{id:o}});window.open(e,"_blank")};return P(async()=>{C.fetchTasks();try{const o=await X();g.value=o.map(e=>({id:e.id,title:e.title,date:_(e.created_at).format("YYYY-MM-DD"),type:e.level,tag:e.level==="important"?"重要":"普通"}))}catch(o){console.error(o)}try{const o=_().format("YYYY-MM-DD"),e=_().add(60,"day").format("YYYY-MM-DD"),c=await Z({start_date:o,end_date:e});w.value=c.slice(0,2).map(d=>{let p="个人日程";return d.type==="meeting"&&(p=d.meeting_link||"会议室"),{id:d.id,title:d.title,month:_(d.start_time).format("MM月"),day:_(d.start_time).format("DD"),time:`${_(d.start_time).format("HH:mm")}-${_(d.end_time).format("HH:mm")}`,location:p}})}catch(o){console.error(o)}}),(o,e)=>{var $;const c=m("el-icon"),d=m("el-button"),p=m("el-tag"),D=m("el-card"),A=m("el-checkbox"),V=m("el-empty"),E=m("el-dialog");return r(),u("div",ee,[s("div",te,[s("h2",se,"欢迎回来, "+l((($=f(N).userInfo)==null?void 0:$.username)||"用户"),1),s("div",ae,[a(d,{type:"primary",size:"large",onClick:U},{default:n(()=>[a(c,null,{default:n(()=>[a(f(G))]),_:1}),e[4]||(e[4]=i(" 新建文档 ",-1))]),_:1}),a(d,{type:"success",size:"large",onClick:j},{default:n(()=>[a(c,null,{default:n(()=>[a(f(J))]),_:1}),e[5]||(e[5]=i(" 新建任务 ",-1))]),_:1})])]),s("div",ne,[s("div",oe,[a(D,{class:"dashboard-card announcement-card"},{header:n(()=>[s("div",le,[s("span",null,[a(c,null,{default:n(()=>[a(f(K))]),_:1}),e[6]||(e[6]=i(" 公告",-1))]),a(d,{text:"",onClick:e[0]||(e[0]=t=>k.value=!0)},{default:n(()=>[...e[7]||(e[7]=[i("更多",-1)])]),_:1})])]),default:n(()=>[s("div",de,[(r(!0),u(v,null,h(B.value,t=>(r(),u("div",{key:t.id,class:"announcement-item"},[s("div",ie,[a(p,{size:"small",type:t.type==="important"?"danger":"primary"},{default:n(()=>[i(l(t.tag),1)]),_:2},1032,["type"]),s("span",{class:"title-text",onClick:b=>M(t.id)},l(t.title),9,re)]),s("span",ce,l(t.date),1)]))),128))])]),_:1})]),s("div",ue,[a(D,{class:"dashboard-card"},{header:n(()=>[s("div",_e,[s("span",null,[a(c,null,{default:n(()=>[a(f(O))]),_:1}),e[8]||(e[8]=i(" 待处理任务",-1))]),a(d,{text:"",onClick:e[1]||(e[1]=t=>o.$router.push("/tasks"))},{default:n(()=>[...e[9]||(e[9]=[i("查看全部",-1)])]),_:1})])]),default:n(()=>[s("div",me,[(r(!0),u(v,null,h(Y.value,t=>(r(),u("div",{key:t.id,class:"task-item"},[s("div",pe,[a(A,{modelValue:t.completed,"onUpdate:modelValue":b=>t.completed=b,disabled:""},{default:n(()=>[i(l(t.title),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),a(p,{size:"small",type:q(t.priority),effect:"plain"},{default:n(()=>[i(l(t.priority),1)]),_:2},1032,["type"])]),s("span",fe,"截止: "+l(t.deadline),1)]))),128)),Y.value.length===0?(r(),z(V,{key:0,description:"暂无待办任务","image-size":60})):H("",!0)])]),_:1}),a(D,{class:"dashboard-card"},{header:n(()=>[s("div",ve,[s("span",null,[a(c,null,{default:n(()=>[a(f(Q))]),_:1}),e[10]||(e[10]=i(" 近期会议",-1))]),a(d,{text:"",onClick:e[2]||(e[2]=t=>o.$router.push("/schedule"))},{default:n(()=>[...e[11]||(e[11]=[i("日历",-1)])]),_:1})])]),default:n(()=>[s("div",he,[(r(!0),u(v,null,h(w.value,t=>(r(),u("div",{key:t.id,class:"meeting-item"},[s("div",ye,[s("span",ge,l(t.month),1),s("span",ke,l(t.day),1)]),s("div",we,[s("div",De,l(t.title),1),s("div",be,l(t.time)+" | "+l(t.location),1)])]))),128)),w.value.length===0?(r(),z(V,{key:0,description:"暂无近期会议","image-size":60})):H("",!0)])]),_:1})])]),a(E,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=t=>k.value=t),title:"所有公告",width:"600px"},{default:n(()=>[s("div",xe,[(r(!0),u(v,null,h(g.value,t=>(r(),u("div",{key:t.id,class:"announcement-item"},[s("div",Ce,[a(p,{size:"small",type:t.type==="important"?"danger":"primary"},{default:n(()=>[i(l(t.tag),1)]),_:2},1032,["type"]),s("span",{class:"title-text",onClick:b=>M(t.id)},l(t.title),9,Ye)]),s("span",Me,l(t.date),1)]))),128))])]),_:1},8,["modelValue"])])}}},Ne=F(Ve,[["__scopeId","data-v-0a638e86"]]);export{Ne as default};
